security_scan:
  stage: test
  script:
    - echo "ğŸ” Starting Security Scan..."
    - echo "ğŸ“ Current working directory:"
    - pwd
    - echo "ğŸ“‚ Files in current directory:"
    - ls -la
    - echo "ğŸ” Looking for index.js:"
    - find . -name "index.js" -type f
    
    # Update packages and install required tools
    - apt-get update && apt-get install -y curl unzip tar nodejs npm
    
    # Verify Node.js is installed
    - node --version
    - npm --version
    
    # Install dependencies if package.json exists
    - |
      if [ -f "package.json" ]; then
        echo "ğŸ“¦ Installing dependencies..."
        npm install
      fi
    
    # Run the script
    - echo "ğŸš€ Running index.js from $(pwd)"
    - node index.js
    
    - echo "âœ… Scan complete."
  artifacts:
    paths:
      - scan-results.json
    expire_in: 7 days
  cache:
    key: npm-cache-$CI_COMMIT_REF_SLUG
    paths:
      - node_modules/
  rules:
    - when: always