stages:
  - security

security_scan:
  stage: security

  script:
    - echo "üîç Starting Security Scan..."
    - apt-get update && apt-get install -y curl unzip tar
    - npm install
    - node index.js
    - echo "‚úÖ Scan complete."

  artifacts:
    paths:
      - scan-results.json
    expire_in: 7 days

  cache:
    key: npm-cache-$CI_COMMIT_REF_SLUG
    paths:
      - node_modules/

  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == "main"
    - if: $CI_COMMIT_BRANCH == "master"

  variables:
    SCAN_TYPE: "fs"
    SCAN_TARGET: "."
    SEVERITY: "HIGH,CRITICAL"
    IGNORE_UNFIXED: "false"
